{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import Vir from 'vir'\n\nexport default function (options = {}) {\n  let {\n    waterfall = false,\n      threshold = 200,\n      buttonSelector = '.more'\n  } = options\n  return Vir({\n    data: {\n      data: [],\n      state: 'pending'\n    },\n    events: {\n      ['click->' + buttonSelector + '']: 'load'\n    },\n    watch: {\n      data(result) {\n        this.render(result.value)\n      },\n      state(result) {\n        if (result.value == 'finish') {\n          this.destroy()\n        }\n      }\n    },\n    methods: {\n      load() {\n        let state = this.get('state')\n        if (state == 'loading' || state == 'finish') {\n          return\n        }\n        this.set('state', 'loading')\n        this.fetch((state) => {\n          this.set('state', state)\n        })\n      },\n      destroy() {\n        let space = 'loadmore' + this._uid\n        $(window).off(`scroll.${space} resize.${space}`)\n      },\n      fetch(done) {},\n      render(data) {}\n    },\n    init() {\n      if (!waterfall) {\n        return\n      }\n\n      let $window = $(window)\n      let space = 'loadmore' + this._uid\n      $window.on(`scroll.${space} resize.${space}`, () => {\n        if (this.get('state') == 'loading') {\n          return\n        }\n        if ($(document).height() - $window.scrollTop() - $window.height() < threshold) {\n          this.load()\n        }\n      })\n    }\n  })\n}"],"names":["options","waterfall","threshold","buttonSelector","Vir","result","render","value","destroy","state","get","set","fetch","space","_uid","window","off","done","data","$window","$","on","document","height","scrollTop","load"],"mappings":";;;;;;;;;;;;;;;AAEA,YAAe,YAAwB;;;MAAdA,OAAc,uEAAJ,EAAI;2BAKjCA,OALiC,CAEnCC,SAFmC;MAEnCA,SAFmC,sCAEvB,KAFuB;2BAKjCD,OALiC,CAGjCE,SAHiC;MAGjCA,SAHiC,sCAGrB,GAHqB;8BAKjCF,OALiC,CAIjCG,cAJiC;MAIjCA,cAJiC,yCAIhB,OAJgB;;SAM9BC,IAAI;UACH;YACE,EADF;aAEG;KAHA;mCAMN,YAAYD,cAAZ,GAA6B,EADhC,IACqC,MADrC,UALS;WAQF;UAAA,gBACAE,MADA,EACQ;aACNC,MAAL,CAAYD,OAAOE,KAAnB;OAFG;WAAA,iBAICF,MAJD,EAIS;YACRA,OAAOE,KAAP,IAAgB,QAApB,EAA8B;eACvBC,OAAL;;;KAdG;aAkBA;UAAA,kBACA;;;YACDC,QAAQ,KAAKC,GAAL,CAAS,OAAT,CAAZ;YACID,SAAS,SAAT,IAAsBA,SAAS,QAAnC,EAA6C;;;aAGxCE,GAAL,CAAS,OAAT,EAAkB,SAAlB;aACKC,KAAL,CAAW,UAACH,KAAD,EAAW;gBACfE,GAAL,CAAS,OAAT,EAAkBF,KAAlB;SADF;OAPK;aAAA,qBAWG;YACJI,QAAQ,aAAa,KAAKC,IAA9B;UACEC,MAAF,EAAUC,GAAV,aAAwBH,KAAxB,gBAAwCA,KAAxC;OAbK;WAAA,iBAeDI,IAfC,EAeK,EAfL;YAAA,kBAgBAC,IAhBA,EAgBM;KAlCN;QAAA,kBAoCF;;;UACD,CAACjB,SAAL,EAAgB;;;;UAIZkB,UAAUC,EAAEL,MAAF,CAAd;UACIF,QAAQ,aAAa,KAAKC,IAA9B;cACQO,EAAR,aAAqBR,KAArB,gBAAqCA,KAArC,EAA8C,YAAM;YAC9C,OAAKH,GAAL,CAAS,OAAT,KAAqB,SAAzB,EAAoC;;;YAGhCU,EAAEE,QAAF,EAAYC,MAAZ,KAAuBJ,QAAQK,SAAR,EAAvB,GAA6CL,QAAQI,MAAR,EAA7C,GAAgErB,SAApE,EAA+E;iBACxEuB,IAAL;;OALJ;;GA3CG,CAAP;;;;;"}